{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block extra_head %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link rel="stylesheet" href="{% static 'home/assets_shop/css/swiper-bundle.min.css' %}">
    
    <link rel="stylesheet" href="{% static 'home/assets_shop/css/style.css' %}?v=1.0.9">
    
    <link rel="stylesheet" href="{% static 'home/assets_shop/css/colors/color-1.css' %}">
{% endblock %}
{% block content %}

<!--=============== CART ===============-->

<div class="cart" id="cart">
        <i class="bx bx-x cart__close" id="cart-close"></i>

        <h2 class="cart__title-center">My Cart</h2>

        <div class="cart__container">
            <article class="cart__card">
                <div class="cart__box">
                    {# PFAD KORRIGIERT #}
                    <img src="{% static 'home/assets_shop/img/cart-1.png' %}" alt="" class="cart__img">
                </div>

                <div class="cart__details">
                    <h3 class="cart__title">Windbreaker</h3>
                    <span class="cart__price">$12</span>

                    <div class="cart__amount">
                        <div class="cart__amount-content">
                            <span class="cart__amount-box">
                                <i class="bx bx-minus"></i>
                            </span>

                            <span class="cart__amount-number">1</span>

                            <span class="cart__amount-box">
                                <i class="bx bx-plus"></i>
                            </span>
                        </div>

                        <i class="bx bx-trash-alt cart__amount-trash"></i>
                    </div>
                </div>
            </article>

            <article class="cart__card">
                <div class="cart__box">
                    {# PFAD KORRIGIERT #}
                    <img src="{% static 'home/assets_shop/img/cart-2.png' %}" alt="" class="cart__img">
                </div>

                <div class="cart__details">
                    <h3 class="cart__title">Cardigan Hoodie</h3>
                    <span class="cart__price">$16</span>

                    <div class="cart__amount">
                        <div class="cart__amount-content">
                            <span class="cart__amount-box">
                                <i class="bx bx-minus"></i>
                            </span>

                            <span class="cart__amount-number">1</span>

                            <span class="cart__amount-box">
                                <i class="bx bx-plus"></i>
                            </span>
                        </div>

                        <i class="bx bx-trash-alt cart__amount-trash"></i>
                    </div>
                </div>
            </article>

            <article class="cart__card">
                <div class="cart__box">
                    {# PFAD KORRIGIERT #}
                    <img src="{% static 'home/assets_shop/img/cart-3.png' %}" alt="" class="cart__img">
                </div>

                <div class="cart__details">
                    <h3 class="cart__title">Cartoon</h3>
                    <span class="cart__price">$10</span>

                    <div class="cart__amount">
                        <div class="cart__amount-content">
                            <span class="cart__amount-box">
                                <i class="bx bx-minus"></i>
                            </span>

                            <span class="cart__amount-number">1</span>

                            <span class="cart__amount-box">
                                <i class="bx bx-plus"></i>
                            </span>
                        </div>

                        <i class="bx bx-trash-alt cart__amount-trash"></i>
                    </div>
                </div>
            </article>
        </div>

        <div class="cart__prices">
            <span class="cart__prices-item">3 item</span>
            <span class="cart__prices-total">$38</span>
        </div>
    </div>

    <!--=============== LOGIN ===============-->
<div class="login" id="login">
        <i class="bx bx-x login__close" id="login-close"></i>

        <h2 class="login__title-center">Login</h2>

        <form action="" class="login__form grid">
            <div class="login__content">
                <label for="" class="login__label">Email</label>
                <input type="email" class="login__input">
            </div>

            <div class="login__content">
                <label for="" class="login__label">Password</label>
                <input type="password" class="login__input">
            </div>

            <div>
                <a href="#" class="button">Sign in</a>
            </div>

            {# --- KORRIGIERTER WAGTAIL LINK --- #}
            {# Verwendet die Logik aus deiner index_shop.html #}
            <div>
            {% if registration_page %}
                <p class="signup">Not a member? <a href="{% pageurl registration_page %}">Sign up now</a></p>
            {% else %}
                <p class="signup"><span>Sign up now</span></p>
            {% endif %}
            </div>
        </form>
    </div>
    <!--=============== MAIN ===============-->
<main class="main">
        <section class="details section container">
            <h2 class="breadcrumb__title">Details Page</h2>
            
            <h3 class="breadcrumb__subtitle"><a href="{% pageurl page.get_parent %}">Shop</a> > <span>{{ page.title }}</span></h3>

            <div class="details__container grid">
                <div class="product__images grid">
                    
                    {% if page.product_image %}
                        <div class="product__img">
                            {% image page.product_image height-1000 alt=page.title %}
                        </div>
                    {% endif %}
                </div>

                <div class="product__info">
                    {% if page.orientation %}
                        <p class="details__subtitle">{{ page.orientation | title }}</p>
                    {% endif %}
                    
                    <h3 class="details__title">{{ page.title }}</h3>

                    <div class="details__prices">
                        <span class="details__price" id="product-price">{{ page.price }} €</span>
                    </div>

                    <div class="details__description" style="margin-top: var(--mb-2);">
                        <p style="margin-bottom: var(--mb-0-75);">All prints come in A2 format (42.0 x 59.4 cm).</p>
                        <div class="simple-description">
                            {{ page.description_text | linebreaks }}
                        </div>
                    </div>

                    <form action="{% url 'add_to_cart' product_id=page.id %}" method="POST" id="add-to-cart-form">
                        {% csrf_token %}

                        {% if page.frame_addon_price %}
                        <label for="add_frame_checkbox" class="product-addon-option">
                            <input type="checkbox" name="add_frame" id="add_frame_checkbox" value="true">
                            <span class="fake-checkbox"></span>
                            Add Frame
                        </label>
                        {% endif %}
                        
                        <button type="submit" class="button" id="add-to-cart-btn" style="width: 100%;">Add To Cart</button>
                    </form>
                    </div>
            </div>
        </section>

        <section class="related__products section">
        <h2 class="section__title">Related Products</h2>

        <div class="new__container container">
            <div class="swiper new-swiper">
                <div class="swiper-wrapper">
                    
                    {% for product in related_products %}
                    <div class="shop__content swiper-slide">
                        <a href="{% pageurl product %}" class="related-product__main-link">
                            {% if product.product_image %}
                                {% image product.product_image width-300 alt=product.title class="shop__img" %}
                            {% endif %}
                            <h3 class="shop__title">{{ product.title }}</h3>
                        </a>
                        
                        {% if product.orientation %}
                            <span class="shop__subtitle">{{ product.orientation | title }}</span>
                        {% else %}
                            <span class="shop__subtitle">Product</span>
                        {% endif %}

                        <div class="shop__prices">
                            {% if product.price %}
                                <span class="shop__price">{{ product.price }} €</span>
                            {% endif %}
                        </div>

                        <a href="{% pageurl product %}" class="button shop__button">
                            <i class="bx bx-cart-alt shop__icon"></i>
                        </a>
                    </div>
                    {% endfor %}
                    
                </div>
            </div>
        </div>
    </section>
</main>
    <!--=============== FOOTER ===============-->
<footer class="footer section">
        <div class="footer__container container grid">
            
            <div class="footer__content">
                <a href="#" class="footer__logo">
                     <img src="{% static 'home/assets/images/logo_cumulophib.png' %}" alt="Logo" style="height: 2.5em; vertical-align: middle; margin-right: 0.5em;">
                </a>
                <p class="footer__description"> Danke! </p>
                <div class="footer__social">
                    <a href="https://www.instagram.com/cumulophib/" class="footer__social-link"><i class="bx bxl-instagram-alt"></i></a>
                </div>
            </div>

            <div class="footer__content">
                <h3 class="footer__title">About</h3>
                <ul class="footer__links">
                    {% if about_page %}
                        <li><a href="{% pageurl about_page %}" class="footer__link">About Us</a></li>
                    {% endif %}
                    <li><a href="#" class="footer__link">Customer Support</a></li>
                    <li><a href="#" class="footer__link">Support Center</a></li>
                </ul>
            </div>

            <div class="footer__content">
                <h3 class="footer__title">Our Services</h3>
                <ul class="footer__links">
                    {% if index_shop_page %}
                        <li><a href="{% pageurl index_shop_page %}" class="footer__link">Shop</a></li>
                    {% endif %}
                    <li><a href="#" class="footer__link">Discounts</a></li>
                    <li><a href="#" class="footer__link">Shipping mode</a></li>
                </ul>
            </div>

            <div class="footer__content">
                <h3 class="footer__title">Our Company</h3>
                <ul class="footer__links">
                    {% if registration_page %}
                        <li><a href="{% pageurl registration_page %}" class="footer__link">Register</a></li>
                    {% endif %}
                    {% if contact_page %}
                        <li><a href="{% pageurl contact_page %}" class="footer__link">Contact Us</a></li>
                    {% endif %}
                    {% if about_page %}
                        <li><a href="{% pageurl about_page %}" class="footer__link">About Us</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <span class="footer__copy">&#169; Crypticalcoder. All rights reserved</span>
    </footer>

    <!--=============== LIGHTBOX ===============-->
    <div class="lightbox">
        <div class="lightbox__content">
            <div class="lightbox__close">&times;</div>
            {# PFAD KORRIGIERT #}
            <img src="{% static 'home/assets_shop/img/details-2.png' %}" alt="" class="lightbox__img">
            <div class="lightbox__caption">
                <div class="caption__text">cumulophib</div>
                <div class="caption__counter"></div>
            </div>
        </div>

        <div class="lightbox__controls">
            <div class="prev__item" onclick="prevItem()"><i class="bx bx-chevron-left"></i></div>
            <div class="next__item" onclick="nextItem()"><i class="bx bx-chevron-right"></i></div>
        </div>
    </div>

    <a href="#" class="scrollup" id="scroll-up">
        <i class="bx bx-up-arrow-alt scrollup__icon"></i>
    </a>

    <!-- <div class="style__switcher">
        <div class="style__switcher-toggler s__icon">
            <i class="bx bxs-cog bx-spin"></i>
        </div>

        <h4>Theme Colors</h4>

        <div class="theme__colors js-theme-colors">
            <button type="button"  data-js-theme-color="color-1" class="js-theme-color-item theme__button color-1"><i class="bx bx-check"></i></button>
            <button type="button"  data-js-theme-color="color-2" class="js-theme-color-item theme__button color-2"><i class="bx bx-check"></i></button>
            <button type="button"  data-js-theme-color="color-3" class="js-theme-color-item theme__button color-3"><i class="bx bx-check"></i></button>
            <button type="button"  data-js-theme-color="color-4" class="js-theme-color-item theme__button color-4"><i class="bx bx-check"></i></button>
            <button type="button"  data-js-theme-color="color-5" class="js-theme-color-item theme__button color-5"><i class="bx bx-check"></i></button>
        </div>
    </div> -->
    
    <script>
        const productItems = document.querySelectorAll(".product__img"),
              totalProductItems = productItems.length,
              lightbox = document.querySelector(".lightbox"),
              lightboxImg = lightbox.querySelector(".lightbox__img"),
              lightboxClose = lightbox.querySelector(".lightbox__close"),
              lightboxCounter = lightbox.querySelector(".caption__counter");
        let itemIndex = 0;

        for(let i=0; i<totalProductItems; i++) {
            productItems[i].addEventListener("click", function() {
                itemIndex=i;
                changeItem();
                toggleLightbox();
            })
        }

        function nextItem() {
            if(itemIndex === totalProductItems-1) {
                itemIndex=0;
            }

            else{
                itemIndex++
            }
            changeItem()
        }

        function prevItem() {
            if(itemIndex === 0) {
                itemIndex=totalProductItems-1;
            }

            else{
                itemIndex--
            }
            changeItem()
        }

        function toggleLightbox() {
            lightbox.classList.toggle("open");
        }

        function changeItem() {
            // Dieses Skript sucht nach dem 'img'-Tag innerhalb des angeklickten '.product__img'
            let imgTag = productItems[itemIndex].querySelector("img");
            if (imgTag) {
                let imgSrc = imgTag.getAttribute("src");
                lightboxImg.src = imgSrc;
                lightboxCounter.innerHTML = (itemIndex + 1) + " of " + totalProductItems;
            }
        }

        // close lightbox (event-Variable hinzugefügt)
        lightbox.addEventListener("click", function(event) {
            if(event.target === lightboxClose || event.target === lightbox) {
                toggleLightbox()
            }
        })
    </script>

    {# PFAD KORRIGIERT #}
    <script src="{% static 'home/assets_shop/js/swiper-bundle.min.js' %}"></script>

    {# PFAD KORRIGIERT #}
    <script src="{% static 'home/assets_shop/js/main.js' %}"></script>

{# HIER ENDET DER 'content' BLOCK, DER IN 'base.html' EINGEFÜGT WIRD #}
{% endblock %}


{% block extra_js %}
    {{ block.super }} {# Inherits scripts from base.html #}

    <script src="{% static 'home/assets_shop/js/swiper-bundle.min.js' %}?v=1.0.9"></script>
    <script src="{% static 'home/assets_shop/js/main.js' %}?v=1.0.9"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const priceDisplay = document.getElementById('product-price');
        const frameCheckbox = document.getElementById('add_frame_checkbox');
        
        // Your base price (e.g., 39.99)
        const basePrice = parseFloat("{{ page.price }}");
        
        // Your final framed price (59.99)
        const framedPrice = 59.99; 

        if (priceDisplay && frameCheckbox) {
            frameCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    // SET price TO 59.99
                    priceDisplay.textContent = framedPrice.toFixed(2) + ' €';
                } else {
                    // SET price BACK to base
                    priceDisplay.textContent = basePrice.toFixed(2) + ' €';
                }
            });
        }
    });
    </script>
    <script>
        const productItems = document.querySelectorAll(".product__img"),
              totalProductItems = productItems.length,
              lightbox = document.querySelector(".lightbox"),
              lightboxImg = lightbox.querySelector(".lightbox__img"),
              lightboxClose = lightbox.querySelector(".lightbox__close"),
              lightboxCounter = lightbox.querySelector(".caption__counter");
        let itemIndex = 0;

        for(let i=0; i<totalProductItems; i++) {
            productItems[i].addEventListener("click", function() {
                itemIndex=i;
                changeItem();
                toggleLightbox();
            })
        }

        function nextItem() {
            if(itemIndex === totalProductItems-1) {
                itemIndex=0;
            }
            else{
                itemIndex++
            }
            changeItem()
        }

        function prevItem() {
            if(itemIndex === 0) {
                itemIndex=totalProductItems-1;
            }
            else{
                itemIndex--
            }
            changeItem()
        }

        function toggleLightbox() {
            lightbox.classList.toggle("open");
        }

        function changeItem() {
            // This script looks for the 'img' tag inside the clicked '.product__img'
            let imgTag = productItems[itemIndex].querySelector("img");
            if (imgTag) {
                let imgSrc = imgTag.getAttribute("src");
                lightboxImg.src = imgSrc;
                lightboxCounter.innerHTML = (itemIndex + 1) + " of " + totalProductItems;
            }
        }

        // close lightbox
        lightbox.addEventListener("click", function(event) {
            if(event.target === lightboxClose || event.target === lightbox) {
                toggleLightbox()
            }
        })
    </script>
{% endblock %}